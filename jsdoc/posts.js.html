<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: posts.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: posts.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { query } from '../db/index.js';
/**
 * GET's all data from posts-table
 * @returns {Array.&lt;object>} An array of posts objects
 */
export async function getAllPosts() {
  const results = await query('SELECT * FROM posts');
  const postsArray = results.rows;
  return postsArray;
}


/**
 * GET's all posts from posts-table with specified tag
 * @param {String} tag 
 * @returns {Array.&lt;object>} An array of posts objects filtered by a tag
 */
export async function getPostByTag(tag) {
  const results = await query(
    'SELECT * FROM posts LEFT JOIN tags_table ON posts.post_id=tags_table.post_id WHERE tags_table.tag=$1;',
    [tag]
  );
  const postArr = results.rows;
  return postArr;
}

/**
 * ADD's new post to the posts-table and ADD's all relevant tags to tags-table with the corresponding post ID
 * @param {{
 * author: String
 * title: String
 * thumbnail: String
 * summary: String
 * date_posted: String
 * url: String
 * tags: Array.&lt;string>
 * }} post 
 * @returns {Array} An array with an object and another array of objects 
 */
export async function addNewPost(post) {
  const newPost = await query(
    'INSERT INTO posts (author, title, thumbnail, summary, date_posted, url, tags) VALUES ($1, $2, $3, $4, $5, $6, $7) RETURNING *;',
    [
      post.author,
      post.title,
      post.thumbnail,
      post.summary,
      post.date_posted,
      post.url,
      post.tags,
    ]
  );
  const newPostID = newPost.rows[0].post_id;
  const newTags = await Promise.all(
    post.tags.map(async (tag) => {
      let newTag = await query(
        'INSERT INTO tags_table (tag, post_id) VALUES ($1, $2) RETURNING *',
        [tag, newPostID]
      );
      return newTag.rows[0];
    })
  );
  const addPost = [newPost.rows[0], newTags];
  return addPost;
}

/**
 * DELETE's specified post from posts-table and corresponding tags from tags-table
 * @param {string} id 
 * @returns {Array} An array with the deleted rows from the database 
 */

export async function deletePostByID(id) {
  const deletedTags = await query(
    'DELETE FROM tags_table WHERE post_id = $1 RETURNING *;',
    [id]
  );
  const deletedPost = await query(
    'DELETE FROM posts WHERE post_id = $1 RETURNING *;',
    [id]
  );
  const deleteConfirm = [deletedPost, deletedTags];
  return deleteConfirm;
}
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#addNewPost">addNewPost</a></li><li><a href="global.html#deletePostByID">deletePostByID</a></li><li><a href="global.html#getAllPosts">getAllPosts</a></li><li><a href="global.html#getPostByTag">getPostByTag</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.0</a> on Wed Nov 30 2022 14:19:51 GMT+0000 (Greenwich Mean Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
